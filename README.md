# virtmanager

## Запуск

Локальная машина:
```
git clone git@github.com:romanov9617/virtmanager.git
cd virtmanager
```
Заполните `.env` файл своими значениями
```
pip install poetry
poetry install
python3 prepare_db.py
python3 main.py
```

## Интерфейс командной строки

1. `login`  - вход в аккаунт пользователя
	1. `--password {username}:{password}` - авторизация по паролю
2. `logout` - выход из аккаунта пользователя
3. `root` - запуск команд суперпользователя.
	1. `create` - создание сущностей
		1. `machine` - создание виртуальной машины
		2. `user` - регистрация пользователя
	2. `show` - вывод таблиц с информацией
		1. `machines` - вывод информации о машинах
			1. `--full` - подробное описание машины с компонентами, их характеристиками и процентом использования компонента в машине
			2. `--short` - краткое описание машин, общее количество выделенных ресурсов машины
		2. `components` - вывод информации о компонентах
			1. `processors` - процессорах
			2. `rams` - плашках оперативной памяти
			3. `hard_drives` - жестких дисках
	3. `grant {machine_allias}:{username}:{admin(Optional)}` - выдача прав на машину `{machine_allias}` пользователю `{username}`
	4. `revoke {machine_allias}:{username}` - отобрать права на машину `{machine_allias}` у пользователя `username`
4. `connect` - подключение к машине
	1. `--allias {machine_allias}` - подключение к машине по ее имени
	Закончить взаимодействие с машиной можно передав ключевое слово `exit`
5. `show` - вывод информации, доступной любому пользователю
	1. `machines` - вывод информации о машинах
		1. `allowed` - машины, на которые пользователь может подключиться
		2. `admin` - машины, на которых пользователь обладает правами админа
6. `exit` - завершение работы менеджера

## Структура базы данных


## Особенности

1. Приложение работает с CLI-интерфейсом.
	Я изучил ряд библиотек для построения CLI на Python:
	* argparse
	* Click
	Однако, не нашел необходимого функционала, который я бы хотел показать. Для этого мне пришлось реализовать паттерн `Цепочка обязанностей` для реализации динамического и простого разбора команд, а также доведение команд и параметров до исполнителей.
2. Подключение к машинам происходит с помощью библиотеки `asyncio`и использования сокетов.
3. Реализовано разграничение прав пользователей.
	Реализация позволяет в будущем расширить политики использования машин без серьезного изменения кодовой базы.
4. Реализовано добавление и поднятие виртуальной машины.
	Реализован паттерн  `Фабрика`, который позволяет нам просто создать дополнительный вид машины. На данный момент они все создаются одним и тем же способом, однако, подготовлена возможность создания машин по разному, в зависимости от ее бизнес-логики или технических реализаций.
	Кроме того, каждая "игрушечная" машина, которая создается в процессе работы менеджера ведет себя по разному (хотя все они выполняют роль эхо-сервера), и по разному выполняет команды, которые ей передали:
	`Ubuntu` -  делает текст заглавными буквами
	`Windows` - делает капитализацию букв
	`MacOS` - разворачивает текст
5. Реализовано разделение CRUD операций и запросов, которые могут быть использованы для аналитики. В будущем это позволит использовать разные экземпляры базы данных для построения аналитики и отчетности и бизнес-логики приложения.
6. Реализовано логирование входа и выхода пользователя на машинах.
7. К сожалению, я не успел написать автоматизированные тесты и docker-сompose.yaml
